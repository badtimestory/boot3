<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
 <mapper namespace="com.iu.boot3.product.ProductMapper">
 	
 	<!-- 리스트 출력 Mapper -->
 	<select id="getList" resultMap="getListResult" parameterType="Pager" >
 		SELECT P.*, F.* 
 		FROM 
 			(
 				SELECT 
 				* 
 				FROM PRODUCT 
 				WHERE PRODUCTNUM > 0 
 				ORDER BY PRODUCTNUM DESC
 				LIMIT #{startRow}, #{perPage}
 			) P
 			LEFT JOIN
 			PRODUCTFILES F
 			USING (PRODUCTNUM)
 	</select>
 	
 	<resultMap type="productVO" id="getListResult">
 		<id column="productNum" property="productNum"/>
 		<result column="productName" property="productName"/>
 		<result column="productPrice" property="productPrice"/>
 		<result column="productCount" property="productCount"/>
 		<result column="productDetail" property="productDetail"/>
 		<collection property="productFilesVO" javaType="java.util.List" ofType="productFilesVO">
	 		<id column="" property=""/>
	 		<result column="fileNum" property="fileNum"/>
	 		<result column="fileName" property="fileName"/>
	 		<result column="oriName" property="oriName"/>
 		</collection>
 	
 	</resultMap>
 	
 	<!-- 리스트 전체 갯수 -->
 	<select id="getTotalCount" resultType="java.lang.Integer" parameterType="Pager">
 		SELECT COUNT(PRODUCTNUM) FROM PRODUCT
 	</select>
 	
 	<!-- 제품 추가 Mapper -->
 	<insert id="setAdd" parameterType="ProductVO" useGeneratedKeys="true" keyProperty="productNum">
 		INSERT INTO PRODUCT (PRODUCTNUM, PRODUCTNAME, PRODUCTPRICE, PRODUCTCOUNT, PRODUCTDETAIL)
 		VALUES (#{productNum}, #{productName}, #{productPrice}, #{productCount}, #{productDetail})
 	</insert>
 	
 	<!-- 파일 추가 Mapper -->
 	<insert id="setFileAdd" parameterType="ProductFilesVO">
 		INSERT INTO PRODUCTFILES (FILENUM, PRODUCTNUM, FILENAME, ORINAME)
 		VALUES (NULL, #{productNum}, #{fileName}, #{oriName})
 	</insert>
 	
 	
 
 </mapper> 